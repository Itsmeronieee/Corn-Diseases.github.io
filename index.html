<!DOCTYPE html>
<html>
  <head>
    <title>ARCornia</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link rel="stylesheet" href="styles.css">
    <script src="https://aframe.io/releases/1.0.4/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar-nft.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v6.1.1/dist/aframe-extras.min.js"></script>
    <script src="gesture-detector.js"></script>
    <script src="gesture-handler.js"></script>    
  </head>

  <body>
    <a-scene
      arjs="trackingMethod: best; sourceType: webcam;debugUIEnabled: false;"
      embedded
      renderer="logarithmicDepthBuffer: true;"
      vr-mode-ui="enabled: false"
      gesture-detector
      id="scene"
    >
      <figure>
          <figcaption>ARCornia:</figcaption>
      </figure>

      <a-assets>
        <a-asset-item
          id="maiz"
          src="./maiz.glb"
        >
        </a-asset-item>
        <a-asset-item
          id="among_us_character"
          src="./among_us_character.glb"
        >
        </a-asset-item>
      </a-assets>

      <a-marker
        type="pattern"
        url="https://itsmeronieee.github.io/diseases.github.io/marker/pattern-blight5.patt"
        id="marker" <!-- Add unique ID to the first marker -->
      >
        <a-entity id="entity" look-at="[camera]">
          <a-entity
            gltf-model="#maiz" 
            scale="1 1 1" 
            position="0 0 0" 
            class="clickable"
            gesture-handler
            animation__rotation="property: rotation; to: 0 360 0; loop: true; dur: 10000"
          >
          </a-entity>

          <a-sound src="#song" autoplay="true"></a-sound>

          <!-- Empty entity to hold the dynamically added text -->
          <a-entity id="textContainer"></a-entity>
        </a-entity>
      </a-marker>

      <!-- Second Sample -->

      <a-marker
        type="pattern"
        url="https://itsmeronieee.github.io/diseases.github.io/marker/pattern-Corn_Common_Rust.patt"
        id="marker2" <!-- Add unique ID to the second marker -->
      >
        <a-entity id="entity2" look-at="[camera]">
          <a-entity
            gltf-model="#among_us_character"
            scale="0.002 0.002 0.002" <!-- Make it smaller -->
            position="0 0 0"
            class="clickable"
            gesture-handler
            animation-mixer="clip: *; loop: repeat; timeScale: 2"
          >
          </a-entity>

          <a-sound src="#newSong" autoplay="true"></a-sound>

          <!-- Empty entity to hold the dynamically added text -->
          <a-entity id="textContainer2"></a-entity>
        </a-entity>
      </a-marker>

      <a-entity camera></a-entity>
    </a-scene>

    <!-- JavaScript code to dynamically add and remove text -->
    <script>
      // Get a reference to the scene
      const scene = document.querySelector("#scene");

      // Function to create and add the text entity
      function addTextEntity(text, containerId) {
        const textContainer = document.querySelector(`#${containerId}`);
        const textEntity = document.createElement("a-entity");
        textEntity.setAttribute("position", "0 0.2 -1");
        textEntity.setAttribute("text", `value: ${text}; align: center; width: 6; color: white`);
        textContainer.appendChild(textEntity);
      }

      // Event listener to add text when marker is detected
      scene.addEventListener("markerFound", (event) => {
        const marker = event.target;
        const markerId = marker.getAttribute("id");

        if (markerId === "marker") {
          // Display AR Blight text for the first marker
          addTextEntity("AR Blight", "textContainer");
        } else if (markerId === "marker2") {
          // Display AR Common Rust text for the second marker
          addTextEntity("AR Common Rust", "textContainer2");
        }
      });

      // Event listener to remove text when marker is lost (optional)
      scene.addEventListener("markerLost", (event) => {
        const marker = event.target;
        const markerId = marker.getAttribute("id");

        if (markerId === "marker") {
          // Remove the text entity when the first marker is lost
          const textContainer = document.querySelector("#textContainer");
          textContainer.innerHTML = "";
        } else if (markerId === "marker2") {
          // Remove the text entity when the second marker is lost
          const textContainer2 = document.querySelector("#textContainer2");
          textContainer2.innerHTML = "";
        }
      });
    </script>
  </body>
</html>
